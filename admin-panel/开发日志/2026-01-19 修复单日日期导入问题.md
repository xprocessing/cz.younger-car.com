# 2026-01-19 修复单日日期导入问题

## 更新内容

### 1. 问题描述
- **现象**：在导入公司运营费用数据时，日期小于10的记录（如2024-12-9）无法成功导入
- **原因**：日期格式验证正则表达式要求月份和日期必须为两位数（如2024-12-09），导致单日日期无法通过验证

### 2. 修复方案
- **文件**：`controllers/CompanyCostsController.php`
- **方法**：`processImportRow()`

#### 2.1 修改正则表达式
- **原正则**：`/^\d{4}-\d{2}-\d{2}$/`（要求月份和日期必须为两位数）
- **新正则**：`/^\d{4}-\d{1,2}-\d{1,2}$/`（允许月份和日期为1-2位数）

#### 2.2 添加日期格式化功能
- 在日期验证通过后，将日期格式化为标准的YYYY-MM-DD格式
- 使用`str_pad()`函数确保月份和日期为两位数
- 示例：将"2024-12-9"转换为"2024-12-09"

### 3. 技术细节

#### 3.1 修复代码
```php
// 验证日期格式
if (!preg_match('/^\d{4}-\d{1,2}-\d{1,2}$/', $row[0])) {
    $errors[] = "第 {$rowCount} 行：日期格式不正确，应为YYYY-MM-DD";
    $errorCount++;
    return;
}

// 将日期格式化为标准的YYYY-MM-DD格式（确保月份和日期为两位数）
$dateParts = explode('-', $row[0]);
if (count($dateParts) === 3) {
    $year = $dateParts[0];
    $month = str_pad($dateParts[1], 2, '0', STR_PAD_LEFT);
    $day = str_pad($dateParts[2], 2, '0', STR_PAD_LEFT);
    $row[0] = "{$year}-{$month}-{$day}";
}
```

#### 3.2 修复逻辑
1. 验证日期格式，允许1-2位的月份和日期
2. 将日期拆分为年、月、日三部分
3. 使用`str_pad()`函数为月份和日期补零，确保为两位数
4. 重新组合为标准的YYYY-MM-DD格式
5. 继续后续的导入验证和处理

### 4. 测试验证

- **测试文件**：company_costs_template.csv
- **测试数据**：包含单日日期的记录，如"2025-12-9,运德美东仓,169.49,仓储费用"
- **预期结果**：所有记录都能成功导入，单日日期会自动转换为标准格式

### 5. 优化效果

- 提高了导入功能的兼容性，支持更多格式的日期输入
- 增强了用户体验，减少了因日期格式问题导致的导入失败
- 保持了数据库中日期格式的统一性
- 修复了用户报告的具体问题

## 总结

本次更新成功修复了公司运营费用模块中单日日期无法导入的问题。通过修改日期验证正则表达式和添加日期格式化功能，提高了导入功能的兼容性和用户体验。所有修改都经过了PHP语法检查，确保代码的正确性。