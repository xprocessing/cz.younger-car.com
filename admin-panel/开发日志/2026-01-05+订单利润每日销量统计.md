# 订单利润统计功能更新

## 日期
2026-01-05

## 更新内容

### 最近30天每日销量统计

#### 修改文件
- `models/OrderProfit.php` - 新增 `getDailySalesStats()` 方法
- `controllers/OrderProfitController.php` - 调用每日销量统计方法
- `views/order_profit/stats.php` - 添加每日销量统计图表

#### 功能说明
根据order_profit表的global_purchase_time字段统计最近30天每日的订单销量，并以柱状图形式展示。

#### 数据查询
```sql
SELECT 
    DATE(global_purchase_time) as sale_date,
    COUNT(*) as order_count
FROM order_profit
WHERE global_purchase_time >= ? 
AND global_purchase_time <= ?
GROUP BY DATE(global_purchase_time)
ORDER BY sale_date ASC
```

#### 图表显示
- 使用Canvas绘制柱状图
- X轴显示日期（月-日格式）
- Y轴显示订单数量
- 柱状图颜色：蓝色（有数据）、灰色（无数据）
- 显示订单数量标签和日期标签

#### 实现细节
- 模型方法返回日期和订单数量
- 控制器调用模型方法并传递给视图
- 视图使用JavaScript Canvas API绘制图表
- 处理无数据情况，显示"暂无数据"提示

## 技术要点

### 数据库查询
- 使用 `DATE()` 函数提取日期部分
- 使用 `COUNT(*)` 统计每日订单数量
- 使用 `GROUP BY DATE(global_purchase_time)` 按日期分组
- 按日期升序排列

### 前端图表
- 使用原生Canvas API绘制，不依赖第三方库
- 动态计算柱状图宽度和高度
- 自动计算最大值用于Y轴缩放
- 支持响应式布局

### 用户体验
- 图表标题清晰标注"最近30天每日销量统计"
- 数据可视化直观展示销量趋势
- 无数据时友好提示

## 后续优化建议

1. 添加日期范围选择功能
2. 支持导出每日销量数据
3. 添加销量趋势分析（环比、同比）
4. 优化大数据量查询性能
5. 添加销量预警功能
