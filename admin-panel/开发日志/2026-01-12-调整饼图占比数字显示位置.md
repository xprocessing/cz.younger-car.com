# 2026-01-12 调整饼图占比数字显示位置

## 更新内容

将dashboard.php中饼图的占比数字从扇区外移动到扇区内显示，优化图表的可读性和视觉效果。

## 修改文件

- `admin-panel/views/dashboard.php`

## 具体修改

1. **在扇区内绘制占比数字**：
```javascript
// 计算扇区中心点
const labelAngle = startAngle + sliceAngle / 2;
const textRadius = radius * 0.6; // 文本距离圆心的距离
const textX = centerX + Math.cos(labelAngle) * textRadius;
const textY = centerY + Math.sin(labelAngle) * textRadius;

// 绘制扇区内百分比
const percentage = ((item.value / total) * 100).toFixed(1) + '%';
ctx.fillStyle = '#fff';
ctx.font = 'bold 12px Arial';
ctx.textAlign = 'center';
ctx.fillText(percentage, textX, textY + 4);
```

2. **简化图例文本**：
```javascript
// 原代码
ctx.fillText(item.label + ': ' + ((item.value / total) * 100).toFixed(1) + '%', itemX + 18, itemY + 10);

// 修改后
ctx.fillText(item.label, itemX + 18, itemY + 10);
```

## 效果

- 占比数字现在直接显示在扇区内，更加直观
- 使用白色粗体字体，确保在各种背景色上都清晰可见
- 文本位置经过优化，位于扇区中心偏外一点，避免与中心区域重叠
- 图例简化为只显示平台名称，减少重复信息
- 保持了平台名称的外部标签（仅在画布足够大时显示），便于用户识别

## 技术细节

- 使用三角函数计算扇区中心点坐标
- 文本距离圆心的距离设置为半径的60%，确保在扇区内居中显示
- 字体颜色设置为白色，与饼图颜色形成鲜明对比
- 字体加粗处理，增强可读性
- 保持了原有的图例功能，只是简化了显示内容