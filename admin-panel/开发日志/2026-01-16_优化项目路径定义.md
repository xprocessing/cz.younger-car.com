# 2026-01-16 优化项目路径定义

## 操作概述

根据要求，优化了项目的路径定义方式，使网站域名`https://cz.younger-car.com/`的使用更加合理，同时使系统引用更加方便。这次调整的核心是区分文件系统路径和URL路径，使代码更加清晰和易于维护。

## 具体修改内容

### 1. 重新设计config.php中的路径定义

**文件**：`config.php`

**修改内容**：

```php
// 文件系统路径定义（传统APP_ROOT用法）
define('APP_ROOT', realpath(dirname(__FILE__))); // 当前文件夹就是服务器根目录
define('ADMIN_PANEL_DIR', APP_ROOT . '/admin-panel');
define('PUBLIC_DIR', ADMIN_PANEL_DIR . '/public');
define('VIEWS_DIR', ADMIN_PANEL_DIR . '/views');

// URL路径定义
define('APP_URL', 'https://cz.younger-car.com/');
define('ADMIN_PANEL_URL', APP_URL . '/admin-panel');
define('PUBLIC_URL', ADMIN_PANEL_URL . '/public');
```

### 2. 更新所有控制器文件中的路径引用

**修改了20+个控制器文件**，包括：
- AIGCController.php
- AuthController.php
- InventoryDetailsController.php
- CostsController.php
- CarDataController.php
- InventoryDetailsFbaController.php
- OrderProfitController.php
- WarehouseController.php
- QueryController.php
- NewProductController.php
- StoreController.php
- ProductsController.php
- YunfeiController.php
- PermissionController.php
- UserController.php
- RoleController.php

**修改内容**：将所有使用`APP_ROOT`进行文件包含的代码改为使用`ADMIN_PANEL_DIR`，例如：

```php
// 原代码
require_once APP_ROOT . '/models/模型名.php';

// 修改后
require_once ADMIN_PANEL_DIR . '/models/模型名.php';
```

### 3. 更新辅助文件中的路径引用

**文件**：`helpers/functions.php`

**修改内容**：将所有使用`APP_ROOT`或`FILESYSTEM_ADMIN_DIR`进行文件包含的代码改为使用`ADMIN_PANEL_DIR`。

### 4. 更新日志系统中的路径引用

**文件**：`includes/Logger.php`

**修改内容**：将日志目录路径从`FILESYSTEM_ADMIN_DIR . '/logs'`改为`ADMIN_PANEL_DIR . '/logs'`。

### 5. 更新异步处理脚本中的路径引用

**文件**：`scripts/process_images_worker.php`

**修改内容**：将所有使用`FILESYSTEM_ADMIN_DIR`进行文件包含的代码改为使用`ADMIN_PANEL_DIR`。

### 6. 更新入口文件中的控制器引用

**文件**：`aigc.php`

**修改内容**：将控制器引用路径从`APP_ROOT . '/controllers/AIGCController.php'`改为`ADMIN_PANEL_DIR . '/controllers/AIGCController.php'`。

### 7. 移除重复的APP_ROOT定义

**文件**：
- `public/track.php`
- `public/query/controller.php`

**修改内容**：移除了这些文件中重复定义的`APP_ROOT`，改为直接使用config.php中定义的常量。

## 优化后的路径引用方式

### 文件系统路径（用于文件操作和包含）
- `APP_ROOT`：服务器根目录（当前文件夹）
- `ADMIN_PANEL_DIR`：管理面板目录
- `PUBLIC_DIR`：公共资源目录
- `VIEWS_DIR`：视图文件目录

### URL路径（用于前端访问）
- `APP_URL`：网站根URL
- `ADMIN_PANEL_URL`：管理面板URL
- `PUBLIC_URL`：公共资源URL

## 影响范围

这次调整影响了项目中的所有文件，但通过系统的更新，确保了：

1. 项目域名`https://cz.younger-car.com/`的正确使用
2. 文件系统路径和URL路径的明确区分
3. 代码的可读性和可维护性的提高
4. 系统引用的方便性

## 后续建议

1. 所有新代码应遵循新的路径定义规范，使用适当的常量
2. 对于文件系统操作，使用`APP_ROOT`、`ADMIN_PANEL_DIR`、`PUBLIC_DIR`等常量
3. 对于URL生成，使用`APP_URL`、`ADMIN_PANEL_URL`、`PUBLIC_URL`等常量
4. 避免直接硬编码路径，尽量使用已定义的常量