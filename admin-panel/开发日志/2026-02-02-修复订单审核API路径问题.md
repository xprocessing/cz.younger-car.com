# 2026-02-02 修复订单审核API路径问题

## 问题描述

在访问 `api_order_review.php` 时出现以下错误：

```
Warning: require_once(/www/wwwroot/cz.younger-car.com/admin-panel/api/../config.php): Failed to open stream: No such file or directory

Fatal error: Failed opening required '/www/wwwroot/cz.younger-car.com/admin-panel/api/../config.php'
```

## 问题原因

API文件实际位置在 `admin-panel/api/api_order_review.php`，而 `config.php` 在项目根目录。

**错误的路径计算**：
- 从 `admin-panel/api/` 向上一级 `../` 只能到达 `admin-panel/`
- 需要再向上一级才能到达项目根目录

**正确的路径**：
- `admin-panel/api/` → `../` → `admin-panel/`
- `admin-panel/` → `../` → 项目根目录
- 所以需要 `../../` 才能到达项目根目录

## 修复方案

### 修复前的代码
```php
<?php
require_once __DIR__ . '/../config.php';
require_once __DIR__ . '/../admin-panel/includes/database.php';
```

### 修复后的代码
```php
<?php
require_once __DIR__ . '/../../config.php';
require_once __DIR__ . '/../includes/database.php';
```

**路径说明**：
- `__DIR__ . '/../../config.php'` - 从 `admin-panel/api/` 向上两级到达项目根目录
- `__DIR__ . '/../includes/database.php'` - 从 `admin-panel/api/` 向上一级到达 `admin-panel/includes/`

## 目录结构

```
cz.younger-car.com/
├── config.php                          (项目根目录)
└── admin-panel/
    ├── api/
    │   └── api_order_review.php         (API文件位置)
    ├── includes/
    │   └── database.php
    └── ...
```

## 影响文件

- `admin-panel/api/api_order_review.php`

## 测试验证

修复后API应该可以正常工作，能够：
1. 正确引入 `config.php`
2. 正确引入 `database.php`
3. 接收POST请求
4. 解析JSON数据
5. 验证必填字段
6. 插入数据库记录
7. 返回JSON响应

## 经验教训

在处理文件路径时，需要特别注意：
1. 使用 `__DIR__` 获取当前文件所在目录
2. 根据实际文件位置计算相对路径
3. 不要假设文件位置，要检查实际目录结构
4. 使用 `../` 向上一级，使用 `../../` 向上两级

## 测试命令

```bash
curl -X POST http://your-domain/admin-panel/api/api_order_review.php \
  -H "Content-Type: application/json" \
  -d '{
    "store_id": "STORE001",
    "global_order_no": "ORD20260202001",
    "local_sku": "SKU12345",
    "receiver_country_code": "US"
  }'
```
