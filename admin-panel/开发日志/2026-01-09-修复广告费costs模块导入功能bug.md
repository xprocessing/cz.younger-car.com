# 2026-01-09 - 修复广告费costs模块导入功能bug

## 问题描述
系统抛出Fatal error：`Uncaught Error: Call to undefined method CostsController::importPaste() in costs.php:35`，导致粘贴CSV内容导入功能无法使用。

## 问题分析
1. 检查了`costs.php`路由文件，发现存在`import_paste`路由调用不存在的`importPaste()`方法
2. 检查了`CostsController.php`控制器，确认没有`importPaste()`方法的实现
3. 查看了`import.php`视图文件，发现粘贴导入表单的action指向了`import_paste`路由
4. 分析控制器中的`importPost()`方法，发现该方法已经同时处理了文件上传和粘贴导入两种情况

## 解决方案
1. **修改导入视图文件**：将粘贴导入表单的action从`import_paste`改为`import_post`
2. **移除无效路由**：删除`costs.php`中对不存在的`importPaste()`方法的调用

### 修改的文件
1. `admin-panel/views/costs/import.php` - 修复表单action属性
2. `admin-panel/costs.php` - 移除无效路由

### 修改内容
1. **视图文件修改**：
   ```php
   <!-- 修改前 -->
   <form method="POST" action="<?php echo APP_URL; ?>/costs.php?action=import_paste">
   
   <!-- 修改后 -->
   <form method="POST" action="<?php echo APP_URL; ?>/costs.php?action=import_post">
   ```

2. **路由文件修改**：
   ```php
   <!-- 删除了以下无效路由 -->
   case 'import_paste':
       $costsController->importPaste();
       break;
   ```

## 验证结果
修复后，粘贴CSV内容导入功能可以正常工作，表单提交到`import_post`路由，由现有的`importPost()`方法处理，该方法已经包含了对粘贴内容的处理逻辑：

```php
// 处理粘贴导入
elseif (isset($_POST['csv_content']) && !empty(trim($_POST['csv_content']))) {
    $csvContent = trim($_POST['csv_content']);
    $lines = explode("\n", $csvContent);
    
    // 跳过表头
    array_shift($lines);
    
    foreach ($lines as $line) {
        if (empty(trim($line))) continue;
        
        $row = str_getcsv($line);
        $rowCount++;
        $this->processImportRow($row, $data, $rowCount, $successCount, $errorCount, $errors);
    }
}
```

## 影响范围
- 仅影响广告费costs模块的导入功能
- 保持了原有功能的完整性，同时修复了错误
- 没有引入新的功能或修改现有业务逻辑