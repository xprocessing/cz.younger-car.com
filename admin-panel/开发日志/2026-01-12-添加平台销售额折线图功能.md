# 2026-01-12 - 添加平台销售额折线图功能

## 功能描述
在dashboard.php页面中添加"各个平台销售额折线图（最近60天）"功能，展示各平台在最近60天内的销售额变化趋势。

## 实现步骤

### 1. 数据库模型扩展
在`OrderProfit`模型中添加了`getDailyPlatformSales`方法：

- **功能**：获取最近60天各平台每日销售额数据
- **SQL查询**：按日期和平台名称分组，计算每日总销售额
- **数据处理**：
  - 移除货币符号并转换为DECIMAL类型
  - 生成连续的日期序列
  - 构建适合前端绘制的数据结构

### 2. 控制器更新
在`AuthController`的`dashboard`方法中：
- 调用`getDailyPlatformSales(60)`方法获取最近60天的数据
- 将数据传递给视图模板

### 3. 视图完善
在`dashboard.php`视图中：
- 添加了一个新的Canvas元素`dailySalesChart`，尺寸为800x400
- 实现了`drawLineChart`函数用于绘制折线图
- 集成到现有的图表绘制系统中

### 4. 折线图绘制逻辑
`drawLineChart`函数的主要功能：

- **坐标轴绘制**：
  - X轴：显示日期，每7天显示一个日期标签
  - Y轴：显示销售额刻度，支持自动计算最大值和刻度间隔

- **图表元素**：
  - 折线：每条折线代表一个平台的销售额变化
  - 数据点：每隔一定间隔显示数据点
  - 数值标签：关键日期显示销售额数值
  - 图例：显示各平台名称和对应的颜色

- **样式设计**：
  - 使用与饼图相同的颜色系统，保持视觉一致性
  - 添加网格线、背景色和图表标题
  - 支持响应式布局

## 技术特点

1. **数据处理**：
   - 使用SQL聚合函数高效计算每日销售额
   - 生成连续日期序列，确保图表的完整性
   - 构建结构化的数据格式，便于前端处理

2. **可视化**：
   - 使用HTML5 Canvas API绘制折线图
   - 支持多平台数据对比
   - 自动计算坐标轴范围和刻度
   - 提供清晰的图例和标签

3. **性能优化**：
   - 限制数据范围为最近60天
   - 优化数据点显示数量，避免过度拥挤
   - 使用高效的Canvas渲染

## 依赖关系

- 数据库表：`order_profit`、`store`
- PHP模型：`OrderProfit`
- 前端技术：HTML5 Canvas

## 使用说明

1. 用户登录后自动访问dashboard页面
2. 在页面底部可以看到"各个平台销售额折线图（最近60天）"
3. 折线图显示各平台在最近60天内的销售额变化趋势
4. 鼠标悬停时可以查看具体数值
5. 图表会自动适应浏览器窗口大小

## 后续优化建议

1. 添加交互功能，支持日期范围选择
2. 实现数据点悬停提示，显示详细信息
3. 添加导出功能，支持将图表导出为图片或PDF
4. 优化移动端显示效果
5. 添加数据筛选功能，支持按平台筛选数据