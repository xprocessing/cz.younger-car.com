# 2026-02-02 更新订单审核模块

## 数据库表结构变化

### order_review 表更新
- 新增字段：`store_id` (店铺ID) - CHAR(50)
- 新增字段：`review_remark` (审单备注) - VARCHAR(255)
- 新增字段：`create_at` (创建时间) - DATETIME

## 代码更新内容

### 1. 视图文件更新

#### index.php
- 表格头部新增"审单备注"和"创建时间"列
- 表格数据行新增 `review_remark` 和 `create_at` 字段显示
- 移除了多余的空行

#### create.php
- 新增"店铺ID"输入字段
- 调整表单布局，将店铺ID放在订单号之前

#### edit.php
- 新增"店铺ID"输入字段，支持编辑
- 调整表单布局，将店铺ID放在订单号之前

#### import.php
- 更新CSV导入说明，在格式中添加"店铺ID"字段
- 更新CSV格式示例：店铺ID,订单号,本地SKU,国家,城市,邮编,仓库ID,物流方式ID,预估邮费,审单状态,审单时间,审单备注
- 更新粘贴导入的placeholder文本

### 2. 控制器文件更新

#### OrderReviewController.php

**createPost() 方法**
- 新增 `store_id` 字段处理
- 数据数组中添加 `store_id` 字段

**editPost() 方法**
- 新增 `store_id` 字段处理
- 数据数组中添加 `store_id` 字段

**processImportRow() 方法**
- 调整CSV列索引，适配新的CSV格式
- 店铺ID：$row[0]
- 订单号：$row[1]
- 本地SKU：$row[2]
- 国家：$row[3]
- 城市：$row[4]
- 邮编：$row[5]
- 仓库ID：$row[6]
- 物流方式ID：$row[7]
- 预估邮费：$row[8]
- 审单状态：$row[9]
- 审单时间：$row[10]
- 审单备注：$row[11]
- 更新必填字段验证逻辑

**export() 方法**
- CSV表头新增"店铺ID"列
- 导出数据中添加 `store_id` 字段

### 3. 模型文件更新

#### OrderReview.php

**create() 方法**
- SQL INSERT语句新增 `store_id` 字段
- 参数数组中添加 `store_id` 参数

**update() 方法**
- SQL UPDATE语句新增 `store_id` 字段
- 参数数组中添加 `store_id` 参数

**batchInsert() 方法**
- SQL INSERT语句新增 `store_id` 字段
- 参数数组中添加 `store_id` 参数

## 影响范围

### 文件列表
1. `admin-panel/views/order_review/index.php`
2. `admin-panel/views/order_review/create.php`
3. `admin-panel/views/order_review/edit.php`
4. `admin-panel/views/order_review/import.php`
5. `admin-panel/controllers/OrderReviewController.php`
6. `admin-panel/models/OrderReview.php`

### 功能影响
- 订单审核列表新增店铺ID、审单备注、创建时间列显示
- 创建和编辑订单审核记录时可以填写店铺ID
- CSV导入/导出支持店铺ID字段
- 数据库操作支持新增字段

## 兼容性说明
- 所有新增字段均设置为可选（nullable）
- 现有数据不受影响，新增字段默认为NULL
- CSV导入保持向后兼容，店铺ID为可选字段
