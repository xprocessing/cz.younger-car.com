# 修复UNION查询列数不匹配错误开发日志

## 1. 错误描述
系统出现了`PDOException: SQLSTATE[21000]: Cardinality violation: 1222 The used SELECT statements have a different number of columns`错误，这是由于SQL查询中的UNION操作的SELECT语句列数不匹配导致的。

## 2. 错误原因
在库存预警功能的SQL查询中，UNION ALL操作的两个SELECT语句列数不一致：

1. **从inventory_details获取数据的SELECT语句**：只选择了4个列（sku, wid, product_valid_num, product_onway）
2. **从order_profit获取数据的SELECT语句**：选择了5个列（local_sku, 0, 0, 0, 0），其中最后一个是quantity_receive

## 3. 修复内容

### 3.1 模型层更新

#### InventoryDetails.php
1. **修复getInventoryAlert()方法**
   - 在总记录数查询的UNION ALL操作中，确保两个SELECT语句都包含quantity_receive列
   - 在主查询的UNION ALL操作中，确保两个SELECT语句都包含quantity_receive列

2. **修复getInventoryAlertBySkuList()方法**
   - 在总记录数查询的UNION ALL操作中，确保两个SELECT语句都包含quantity_receive列
   - 在主查询的UNION ALL操作中，确保两个SELECT语句都包含quantity_receive列
   - 更新HAVING子句，使用正确的字段名quantity_receive_wenzhou

## 4. 技术要点

1. **UNION操作要求**
   - UNION和UNION ALL操作要求参与的SELECT语句具有相同的列数
   - 对应列的数据类型必须兼容
   - 列的顺序必须一致

2. **修复策略**
   - 在缺少列的SELECT语句中添加相应的列，使用默认值（如0）填充
   - 确保字段名和别名一致
   - 检查所有相关的UNION查询，确保修复完整

## 5. 实现效果

- 修复了SQL查询中的列数不匹配错误
- 库存预警功能恢复正常工作
- 保持了温州仓待到货量的正确计算逻辑
- 确保了所有查询和过滤条件的一致性

## 6. 文件变更列表

- `models/InventoryDetails.php`: 修复UNION查询中的列数不匹配错误