# 2026-01-09 - 修复广告费costs模块数值验证bug

## 问题描述
用户在使用广告费costs模块创建记录时，输入有效的数字（如299.50），系统仍然提示"日均广告花费必须是有效的数字"，导致记录无法添加成功。

## 问题分析
1. 检查了`CostsController.php`中的数值验证逻辑
2. 发现原来的验证方式存在问题：`preg_replace('/[^0-9.-]/', '', $value)`虽然保留了数字、小数点和连字符，但`is_numeric()`函数在处理某些边缘情况时可能会返回意外结果
3. 原验证逻辑不够严格，可能允许无效的数字格式（如多个小数点、连字符出现在中间位置等）

## 解决方案
将原有的数值验证逻辑替换为更严格的正则表达式验证：

### 修改的文件
- `admin-panel/controllers/CostsController.php`

### 修改的方法
1. `createPost()` - 创建记录的数值验证
2. `editPost()` - 编辑记录的数值验证  
3. `processImportRow()` - 批量导入的数值验证

### 修改内容
将原验证逻辑：
```php
if (!is_numeric(preg_replace('/[^0-9.-]/', '', $_POST['cost']))) {
    showError('日均广告花费必须是有效的数字');
    redirect(...);
}
```

替换为：
```php
$cost = trim($_POST['cost']);
// 检查是否是有效的数字格式：只能包含数字、一个小数点，连字符只能在开头
if (!preg_match('/^-?\d+(\.\d+)?$/', $cost)) {
    showError('日均广告花费必须是有效的数字');
    redirect(...);
}
```

## 验证结果
新的正则表达式`/^-?\d+(\.\d+)?$/`能够严格验证有效的数字格式：
- 允许正数和负数（负号只能在开头）
- 允许整数和小数（最多一个小数点）
- 不允许无效格式（如多个小数点、字母、空格等）

这样用户可以正常输入有效的数字（如299.50、149.75等）并成功创建记录。

## 影响范围
- 仅影响广告费costs模块的数值验证逻辑
- 不影响其他模块的功能
- 保持了与原有验证规则的兼容性，同时提高了验证的准确性