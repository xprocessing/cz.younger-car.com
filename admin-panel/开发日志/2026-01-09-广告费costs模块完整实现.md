# 广告费costs模块完整实现 - 2026-01-09

## 模块概述

本次实现了基于MVC架构的广告费costs模块，支持完整的增删改查功能、CSV文件导入导出以及粘贴CSV内容导入功能。

## 实现内容

### 1. 模型层 (Model)

**文件:** `models/Costs.php`

**主要功能:**
- 封装与`costs`表相关的所有数据库操作
- 支持单条记录的增删改查
- 支持批量插入数据
- 支持带筛选条件的查询
- 支持分页查询

**关键方法:**
- `getById($id)` - 根据ID获取单条记录
- `getAll($limit, $offset)` - 获取所有记录（带分页）
- `create($data)` - 创建新记录
- `update($id, $data)` - 更新记录
- `delete($id)` - 删除记录
- `batchInsert($data)` - 批量插入数据
- `searchWithFilters($platform_name, $store_name, $start_date, $end_date)` - 带筛选条件的查询
- `getAllWithFilters($platform_name, $store_name, $start_date, $end_date)` - 获取所有符合条件的记录

### 2. 控制器层 (Controller)

**文件:** `controllers/CostsController.php`

**主要功能:**
- 处理HTTP请求和响应
- 实现业务逻辑
- 调用模型层进行数据操作
- 验证用户权限
- 处理表单数据和文件上传

**关键方法:**
- `index()` - 显示记录列表
- `create()` / `createPost()` - 新增记录
- `edit()` / `editPost()` - 编辑记录
- `delete()` - 删除记录
- `import()` - 显示导入页面
- `importPost()` - 处理文件上传导入
- `importPaste()` - 处理粘贴CSV内容导入
- `export()` - 导出记录为CSV文件

### 3. 视图层 (View)

**目录:** `views/costs/`

**文件列表:**
- `index.php` - 记录列表页面
- `create.php` - 新增记录页面
- `edit.php` - 编辑记录页面
- `import.php` - 导入页面（支持文件上传和粘贴导入）

### 4. 入口文件

**文件:** `costs.php`

**主要功能:**
- 路由请求到对应的控制器方法
- 初始化控制器实例

## 技术特点

### 1. 数据安全
- 使用参数化SQL查询防止SQL注入
- 对用户输入进行严格验证
- 验证重复记录（平台、店铺、日期唯一）

### 2. CSV处理
- 支持文件上传导入
- 支持粘贴CSV内容导入
- 导出CSV文件包含BOM头，支持Excel中文显示
- 实现CSV格式验证和大小限制

### 3. 用户体验
- 响应式设计，适配不同屏幕尺寸
- 分页显示数据
- 多条件筛选（平台、店铺、日期范围）
- 操作成功/失败提示
- 表单验证和错误提示

### 4. 代码质量
- 遵循MVC架构设计
- 代码结构清晰，易于维护
- 参考现有模块（如OrderProfit）的成熟模式
- 无语法错误

## 测试结果

- ✅ 模型文件语法检查通过
- ✅ 控制器文件语法检查通过
- ✅ 入口文件语法检查通过
- ✅ 所有视图文件创建完成

## 使用说明

1. **访问模块:** 通过`admin-panel/costs.php`访问广告费管理页面
2. **新增记录:** 点击"新增"按钮，填写表单提交
3. **编辑记录:** 在列表页面点击"编辑"按钮，修改信息后提交
4. **删除记录:** 在列表页面点击"删除"按钮，确认后删除
5. **导入数据:** 
   - 文件导入: 点击"导入"按钮，选择CSV文件上传
   - 粘贴导入: 在导入页面粘贴CSV内容，点击"粘贴导入"
6. **导出数据:** 点击"导出"按钮，下载CSV文件
7. **筛选数据:** 使用页面上方的筛选条件进行数据筛选

## 注意事项

- CSV文件格式: 平台名称,店铺名称,日均广告花费,日期
- 日期格式: YYYY-MM-DD
- 日均广告花费: 数字格式（如299.50）
- 文件大小限制: 10MB
- 记录数量限制: 单次导入最多1000条