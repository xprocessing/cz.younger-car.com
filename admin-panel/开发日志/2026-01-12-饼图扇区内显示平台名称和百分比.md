# 2026-01-12 饼图扇区内显示平台名称和百分比

## 更新内容

在dashboard.php的饼图中，将平台名称和百分比从扇区外移到扇区内显示，使信息更加集中和直观。

## 修改文件

- `admin-panel/views/dashboard.php`

## 具体修改

1. **修改饼图绘制函数，在扇区内显示平台名称和百分比**：
```javascript
// 绘制扇区内平台名称和百分比
const platformName = item.label;
const percentage = ((item.value / total) * 100).toFixed(1) + '%';
ctx.fillStyle = '#fff';
ctx.textAlign = 'center';

// 绘制平台名称
ctx.font = 'bold 10px Arial';
ctx.fillText(platformName, textX, textY - 4);

// 绘制百分比
ctx.font = 'bold 12px Arial';
ctx.fillText(percentage, textX, textY + 10);
```

2. **注释掉外部标签的绘制代码**：
```javascript
// 不再需要外部标签，因为信息已在扇区内显示
// if (width > 300) {
//     const labelX = centerX + Math.cos(labelAngle) * (radius + 15);
//     const labelY = centerY + Math.sin(labelAngle) * (radius + 15);
//     
//     ctx.fillStyle = '#333';
//     ctx.font = '10px Arial';
//     ctx.textAlign = 'center';
//     ctx.fillText(item.label, labelX, labelY);
// }
```

## 效果

- 四个饼图（销售额占比、订单总量占比、毛利润占比、广告费占比）的扇区内现在同时显示平台名称和百分比
- 平台名称使用10px粗体Arial字体，显示在上方
- 百分比使用12px粗体Arial字体，显示在下方
- 文本颜色为白色，确保在各种背景色上都清晰可见
- 不再显示扇区外的平台名称标签，避免信息重复
- 图例功能保持不变，继续显示平台名称和对应的颜色

## 技术细节

- 调整了文本位置计算，使两行文本在扇区内居中显示
- 减小了平台名称的字体大小，确保在小尺寸饼图中也能完整显示
- 百分比仍然保持较大字号，确保关键信息突出
- 使用了白色文本填充，与饼图的彩色扇区形成鲜明对比
- 注释掉了外部标签代码，但保留了相关逻辑，便于后续需要时恢复

这种设计使饼图更加紧凑和直观，用户可以在一个位置获取所有关键信息，提高了数据可视化的效率和可读性。