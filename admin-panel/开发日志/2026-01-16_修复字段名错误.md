# 开发日志：修复字段名错误

## 问题描述
在修复过程中发现多处仍然使用旧字段名'date'而不是'cost_date'的问题，导致SQL查询错误：`SQLSTATE[42S22]: Column not found: 1054 Unknown column 'date' in 'where clause'`

## 修复内容

### 1. 模型层修复（ShopCosts.php）
- **getAllWithFilters方法**：将WHERE子句中的`date >= ?`和`date <= ?`改为`cost_date >= ?`和`cost_date <= ?`
- **update方法**：将参数中的`$data['date']`改为`$data['cost_date']`

### 2. 控制器层修复（ShopCostsController.php）
- **createPost方法**：
  - 检查记录是否存在时，将`$_POST['date']`改为`$_POST['cost_date']`
- **editPost方法**：
  - 检查记录是否存在时，将`$_POST['date']`改为`$_POST['cost_date']`
  - 更新数据时，将$data数组中的键名从`'date'`改为`'cost_date'`

### 3. 视图层修复（edit.php）
- **JavaScript验证代码**：
  - 将`document.getElementById('date')`改为`document.getElementById('cost_date')`
  - 修复中文乱码："日广告花费必须大�?" → "日广告花费必须大于0"
  - 修复中文乱码："请输入费用类�?" → "请输入费用类型"

## 修复验证
- 检查所有文件中的字段名引用，确保没有遗漏的'date'字段名
- 确保所有SQL查询都使用正确的'cost_date'字段名
- 确保表单验证和JavaScript代码都使用正确的元素ID

## 注意事项
- 确保数据库中的字段名确实已从'date'改为'cost_date'
- 如果数据库字段名尚未修改，需要手动执行SQL语句：`ALTER TABLE shop_costs CHANGE date cost_date DATE NOT NULL COMMENT '费用日期（YYYY-MM-DD）';`

修复时间：2026-01-16 10:00:00
修复人员：开发人员