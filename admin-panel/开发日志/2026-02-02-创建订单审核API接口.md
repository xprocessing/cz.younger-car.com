# 2026-02-02 创建订单审核API接口

## 功能概述

创建了一个新的API接口，用于通过POST请求新增订单审核记录，无需权限验证。

## 新增文件

### 1. api_order_review.php
**路径**: `admin-panel/api_order_review.php`

**功能**: 订单审核记录创建API接口

**特性**:
- 支持POST请求
- 不需要权限验证
- 接收JSON格式数据
- 返回JSON格式响应

**请求参数**:
- store_id (string, 可选): 店铺ID
- global_order_no (string, 必填): 订单号
- local_sku (string, 必填): 本地SKU
- receiver_country_code (string, 必填): 国家代码
- city (string, 可选): 城市
- postal_code (string, 可选): 邮编
- wid (int, 可选): 仓库ID
- logistics_type_id (int, 可选): 物流方式ID
- estimated_yunfei (string, 可选): 预估邮费
- review_status (string, 可选): 审单状态
- review_time (string, 可选): 审单时间
- review_remark (string, 可选): 审单备注
- wd_yunfei (object, 可选): 运德运费（JSON对象）
- ems_yunfei (object, 可选): 中邮运费（JSON对象）

**验证逻辑**:
1. 验证请求方法是否为POST
2. 验证JSON格式是否正确
3. 验证必填字段：订单号、本地SKU、国家
4. 检查订单号是否已存在

**响应格式**:
- 成功: `{success: true, message: "订单审核记录创建成功", data: {...}}`
- 失败: `{success: false, message: "错误信息"}`

### 2. api_order_review_test.md
**路径**: `admin-panel/api_order_review_test.md`

**功能**: API接口测试文档

**内容**:
- 接口基本信息
- 请求参数说明
- 请求示例
- 响应格式说明
- 错误码说明
- curl测试命令
- Python测试代码

## 技术实现

### 数据库操作
- 使用PDO预处理语句防止SQL注入
- 检查订单号唯一性
- 返回新插入记录的ID

### JSON处理
- 使用 `file_get_contents('php://input')` 获取POST数据
- 使用 `json_decode()` 解析JSON
- 使用 `json_encode()` 处理JSON字段（wd_yunfei、ems_yunfei）

### 错误处理
- JSON格式错误检测
- 必填字段验证
- 数据库异常捕获
- 友好的错误消息返回

## 使用示例

### 请求示例
```json
{
    "store_id": "STORE001",
    "global_order_no": "ORD20260202001",
    "local_sku": "SKU12345",
    "receiver_country_code": "US",
    "city": "New York",
    "postal_code": "10001",
    "wid": 1,
    "logistics_type_id": 10,
    "estimated_yunfei": "50.00",
    "review_status": "待审核",
    "review_time": "2026-02-02 10:00:00",
    "review_remark": "测试订单",
    "wd_yunfei": {
        "price": 45.00,
        "currency": "USD"
    },
    "ems_yunfei": {
        "price": 320.00,
        "currency": "CNY"
    }
}
```

### 成功响应示例
```json
{
    "success": true,
    "message": "订单审核记录创建成功",
    "data": {
        "id": 1,
        "global_order_no": "ORD20260202001",
        "local_sku": "SKU12345",
        "store_id": "STORE001"
    }
}
```

## 安全性

- 使用PDO预处理语句防止SQL注入
- JSON格式验证
- 必填字段验证
- 订单号唯一性检查

## 兼容性

- 支持所有HTTP客户端（curl、Python requests、JavaScript fetch等）
- 支持跨域请求（如需要可添加CORS头）
- UTF-8编码支持

## 后续优化建议

1. 添加API密钥验证机制
2. 添加请求频率限制
3. 添加日志记录功能
4. 添加批量导入接口
5. 添加CORS支持
