# 处理API响应中图像URL的反引号问题

## 修改内容

1. **更新SSE响应的图像URL提取逻辑**
   - 文件：`models/AIGC.php`
   - 位置：第167-177行
   - 为图像URL添加了trim函数，清理可能存在的反引号和空格

2. **更新非SSE响应的图像URL提取逻辑**
   - 文件：`models/AIGC.php`
   - 位置：第229-236行
   - 同样为图像URL添加了trim函数，确保所有响应格式都能正确处理

## 问题分析

用户提供的API成功响应示例中，图像URL包含反引号：
```json
"image": " `https://dashscope-result-bj.oss-cn-beijing.aliyuncs.com/xxx.png?Expires=xxx` "
```

这些反引号会导致图像URL无法正常使用，因为浏览器会将它们视为URL的一部分。因此需要在提取图像URL时将它们清理掉。

## 解决方案

使用PHP的trim函数，清理图像URL中的反引号和空格：
```php
$image_url = trim($item['image'], " `\n\r");
```

这样处理后，图像URL会变成：
```
https://dashscope-result-bj.oss-cn-beijing.aliyuncs.com/xxx.png?Expires=xxx
```

## 测试

修改后的代码应该能够正确处理以下两种响应格式：

### 成功响应
```json
{
    "output": {
        "choices": [
            {
                "finish_reason": "stop",
                "message": {
                    "content": [
                        {
                            "image": " `https://dashscope-result-bj.oss-cn-beijing.aliyuncs.com/xxx.png?Expires=xxx` ",
                            "type": "image"
                        }
                    ],
                    "role": "assistant"
                }
            }
        ],
        "finished": true
    },
    "usage": {
        "image_count": 1,
        "input_tokens": 0,
        "output_tokens": 0,
        "size": "1280*1280",
        "total_tokens": 0
    },
    "request_id": "a3f4befe-cacd-49c9-8298-xxxxxx"
}
```

### 失败响应
```json
{
    "request_id": "a4d78a5f-655f-9639-8437-xxxxxx",
    "code": "InvalidParameter",
    "message": "num_images_per_prompt must be 1"
}
```

## 注意事项

- 此修改不会影响其他功能，只是增强了API响应的处理能力
- 所有图像URL都会经过清理，确保没有额外的反引号和空格
- 代码保持了良好的兼容性，可以处理多种响应格式