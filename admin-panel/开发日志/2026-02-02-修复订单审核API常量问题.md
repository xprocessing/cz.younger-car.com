# 2026-02-02 修复订单审核API常量问题

## 问题描述

在访问 `api_order_review.php` 时出现以下错误：

```
Fatal error: Uncaught Error: Undefined constant "APP_ROOT" in /www/wwwroot/cz.younger-car.com/admin-panel/includes/database.php:2
```

## 问题原因

`database.php` 文件依赖于 `APP_ROOT` 常量，该常量在项目根目录的 `config.php` 中定义。但 `api_order_review.php` 只引入了 `database.php`，没有先引入 `config.php`，导致常量未定义。

## 修复方案

在 `api_order_review.php` 中，在引入 `database.php` 之前先引入 `config.php`：

```php
<?php
require_once __DIR__ . '/../config.php';
require_once __DIR__ . '/includes/database.php';
```

## 额外修复

同时修复了SQL语句中的占位符数量问题：

**修复前**：
```php
$sql = "INSERT INTO order_review (store_id, global_order_no, local_sku, receiver_country_code, city, postal_code, wd_yunfei, ems_yunfei, wid, logistics_type_id, estimated_yunfei,review_remark) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)";
```

**修复后**：
```php
$sql = "INSERT INTO order_review (store_id, global_order_no, local_sku, receiver_country_code, city, postal_code, wd_yunfei, ems_yunfei, wid, logistics_type_id, estimated_yunfei, review_remark) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)";
```

字段列表有11个字段，占位符现在也对应11个 `?`。

## 影响文件

- `admin-panel/api_order_review.php`

## 测试验证

修复后API应该可以正常工作，能够：
1. 接收POST请求
2. 解析JSON数据
3. 验证必填字段
4. 检查订单号唯一性
5. 插入数据库记录
6. 返回JSON响应

## 经验教训

在引入依赖文件时，需要注意依赖顺序：
- 先引入配置文件（config.php）
- 再引入依赖配置的文件（database.php）

这样可以确保所有必需的常量和配置在使用前都已定义。
