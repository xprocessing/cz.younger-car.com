# review_order_func.py 函数介绍 
get_store_list() 获取店铺列表，store_id 对应platform_name

get_logistics_list() 获取物流渠道列表，type_id，channel_code，logistics_provider_name，wid 是仓库id

get_orders_list() 获取订单列表，global_order_no，store_id，local_sku，receiver_country_code，city，postal_code

get_inventory_details(sku) 获取商品库存列表，参数sku=local_sku 结果：wid 是 仓库id,product_valid_num 是可用库存，average_age是库龄

get_ems_product_spec(sku,platform_name) 通过参数sku=local_sku,platform_name=platform_name 获取中邮仓库商品规格字典，得到 weight  length width height

get_wd_product_spec(sku,platform_name) 通过参数sku=local_sku,platform_name=platform_name 获取运德仓库 商品规格字典，得到 weight  length width height


get_ems_ship_fee(postcode, weight, warehouse, channels, length, width, height) 获取中邮运费试算数据列表。 
其中参数 postcode对应的是postal_code，weight length width height对应review_order.get_ems_product_spec(sku)的weight length width height其中参数 warehouse是固定值"USEA,USWE", channels是channel_code的用","拼接字符串,channel_code对应的logistics_provider_name包含"中邮"


get_wd_ship_fee(channels, country, city, postcode, weight, length, width, height, signatureService) 获取运德运费试算数据列表。
其中参数channels 是channel_code的用","拼接字符串，,channel_code对应的logistics_provider_name包含"运德"。 country是receiver_country_code，city是city，postcode是postal_code，weight length width height对应review_order.get_wd_product_spec(sku)的weight length width height, signatureService是固定值0

运费运费试算服务有限制，channel_code如果超过10个，就分批次处理，每次处理10个channel_code，每次处理之间等待10秒。

edit_order(type_id, wid, global_order_no) 修改领星订单数据。


# 具体业务逻辑：

获取店铺列表，物流渠道列表备用。 

获取所有订单，遍历订单，查询订单可用的物流渠道和仓库，根据库存再次筛选有货的仓库，然后获取商品在中邮和运德仓库的规格，根据规格，订单信息，可用的channel_code，获取两个仓库对应的运费试算数据，并找到最小运费，及对应的type_id和wid

1.获取订单列表,只处理wid="0"的订单

2.根据订单的store_id查找对应的platform_name，根据platform_name匹配对应的logistics_provider_name，比如：Amazon 匹配logistics_provider_name包含 "亚马逊" "公共" 的， eBay匹配包含 "eBay" "公共" 的， Shopify匹配包含 "独立站""公共" 的，通过匹配，可以确定这个订单可用的channel_code，type_id，wid

3.根据订单的local_sku ，通过get_inventory_details(sku) 获取有货的仓库id：wid， 通过wid再次筛选可用的channel_code，type_id

4.通过订单的sku=local_sku,查找在中邮仓库的规格，然后根据规格，订单信息，可用的channel_code，获取运费试算数据（服务器响应时间可能比较长，等待响应时间10秒），并找到totalFee最小运费，及对应的type_id和wid，channel_code   

如果查不到数据，就增加platform_name=platform_name ，再次查询。

5.通过订单的sku=local_sku查找在运德仓库的规格，然后根据规格，订单信息，可用的channel_code，获取运费试算数据（服务器响应时间可能比较长，等待响应时间10秒），并找到totalFee最小运费，及对应的type_id和wid ，channel_code   

6.比较中邮和运德的运费，选择较小的一个运费，（中邮的运费是人民币，运德的运费是美元，需要按照汇率7转换为人民币，再比较大小）输出运费，type_id和wid 结果，channel_code

7.修改订单edit_order(type_id, wid, global_order_no) 前弹窗提示订单的所有信息，库存信息，中邮规格信息，运德规格信息，中邮试算运费，运德试算运费，较小运费的type_id和wid，

8.调用函数post_order_review()，将发送订单数据，存入数据库

传入测试参数（可选参数wd_yunfei、ems_yunfei可省略，默认空字典）
response = post_order_review(
    store_id="110574573074617856",
    global_order_no="ORD202602020101112",
    local_sku="SKU12345",
    receiver_country_code="US",
    city="New York",
    postal_code="10001",
    wd_yunfei={"US": "10.00","US1": "15.00"},
    ems_yunfei={"US": "15.00","US1": "15.00"},
    wid=1,
    logistics_type_id=10,
    estimated_yunfei="50.00",
    review_remark="测试订单"
)


补充：只审核美国和加拿大订单。 那英国，日本 按

编译为可执行文件，隐藏命令窗口
pyinstaller --onefile --windowed batch_review_orde_gui.v4.py
