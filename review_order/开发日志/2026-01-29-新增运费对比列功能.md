# 2026-01-29-新增运费对比列功能

## 更新概述
在批量审核订单GUI中新增了4个列，用于展示运德和中邮的产品规格及运费试算结果，方便用户对比不同物流商的运费。同时调整了列的顺序和标题，使信息展示更加合理。

## 更新内容

### 1. 新增列定义
在结果表格中新增以下列：
- **运德产品规格** (wd_product_spec): 显示运德物流的产品规格（重量和尺寸）
- **中邮产品规格** (ems_product_spec): 显示中邮物流的产品规格（重量和尺寸）
- **中邮邮费试算(元)** (ems_fee): 显示中邮运费试算结果（人民币）
- **运德邮费试算(元)** (wd_fee): 显示运德运费试算结果（人民币）

### 2. 列顺序调整
调整了结果表格的列顺序，使信息展示更加合理：
1. 订单号
2. 状态
3. 有货仓库
4. 可用渠道编码
5. 运德产品规格
6. 中邮产品规格
7. 中邮邮费试算(元)
8. 运德邮费试算(元)
9. 最优运费(元)
10. 物流类型ID
11. 消息

### 3. 列标题优化
优化了部分列的标题，使其更准确：
- "仓库ID" → "有货仓库"
- "渠道编码" → "可用渠道编码"

### 4. 列宽设置
为新增的列设置合适的列宽：
- 有货仓库: 100px
- 可用渠道编码: 150px
- 运德产品规格: 150px
- 中邮产品规格: 150px
- 中邮邮费试算(元): 120px
- 运德邮费试算(元): 120px

### 5. 数据处理逻辑

#### 5.1 result字典扩展
在`process_single_order`方法中，扩展result字典，新增4个字段：
```python
result = {
    # 原有字段...
    "wd_product_spec": "",
    "ems_product_spec": "",
    "ems_fee": 0,
    "wd_fee": 0
}
```

#### 5.2 中邮产品规格和运费记录
在步骤5（计算中邮运费）中：
- 获取中邮产品规格后，格式化为字符串：`{weight}kg,{length}x{width}x{height}cm`
- 将规格字符串保存到`result["ems_product_spec"]`
- 运费试算成功后，将运费保存到`result["ems_fee"]`

#### 5.3 运德产品规格和运费记录
在步骤6（计算运德运费）中：
- 获取运德产品规格后，格式化为字符串：`{weight}kg,{length}x{width}x{height}cm`
- 将规格字符串保存到`result["wd_product_spec"]`
- 运费试算成功后，将人民币运费保存到`result["wd_fee"]`

### 6. 结果展示更新
在`update_results`方法中，更新结果表格插入逻辑，按新的列顺序插入数据：
```python
self.result_tree.insert("", tk.END, values=(
    result.get("global_order_no"),
    result.get("status"),
    result.get("final_wid", ""),
    result.get("final_channel_code", ""),
    result.get("wd_product_spec", ""),
    result.get("ems_product_spec", ""),
    result.get("ems_fee", 0),
    result.get("wd_fee", 0),
    result.get("final_fee", 0),
    result.get("final_type_id", ""),
    result.get("message", "")
))
```

### 7. 异常处理
在订单处理异常时，确保result字典包含所有新增字段，避免显示错误。

## 修改文件
- `batch_review_orde_gui.py`

## 修改位置
- 行 135-137: 列定义更新（调整顺序，移除lowest_fee）
- 行 141-152: 列标题定义（优化标题，调整顺序）
- 行 154-164: 列宽设置（新增列宽，调整顺序）
- 行 348-356: result字典扩展（移除lowest_fee）
- 行 403-404, 420: 中邮产品规格和运费记录
- 行 440-441, 461: 运德产品规格和运费记录
- 行 291-299: 异常处理中的result字典扩展（移除lowest_fee）
- 行 600-612: 结果表格插入更新（调整顺序，移除lowest_fee）

## 功能说明
用户现在可以在批量审核订单的结果表格中看到：
1. 每个订单的有货仓库和可用渠道编码
2. 每个订单使用的运德和中邮产品规格
3. 两个物流商的运费试算结果
4. 最终选择的最优运费方案

列的顺序经过优化，信息展示更加合理，用户可以更直观地对比不同物流商的运费，帮助做出更明智的决策。