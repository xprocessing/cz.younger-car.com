# 2026-01-22 将最近60天每日销量统计添加到dashboard页面

## 功能描述

- **功能名称**：最近60天每日销量统计
- **功能位置**：dashboard.php页面的最上面，"最近30天按平台统计"表格之后，赛道统计模块之前
- **功能说明**：显示最近60天每日的销量统计数据，使用折线图展示销售趋势

## 实现方案

### 1. 控制器层更新 (AuthController.php)

- **添加代码**：在获取最近30天按平台统计数据之后，添加获取最近60天每日销量统计数据的代码
- **具体更改**：
  ```php
  // 获取最近60天每日销量统计数据
  $startDate60 = date('Y-m-d', strtotime('-60 days'));
  $dailySalesStats = $orderProfitModel->getDailySalesStats($startDate60, $endDate);
  ```

### 2. 视图层更新 (dashboard.php)

- **添加图表**：在"最近30天按平台统计"表格之后，赛道统计模块之前，添加"最近60天每日销量统计"的图表
- **实现细节**：
  - 参照order_profit/stats.php文件中的图表结构
  - 使用canvas元素创建图表容器
  - 添加标题"最近60天每日销量统计"

### 3. JavaScript代码更新 (dashboard.php)

- **修改现有代码**：将原有的"dailySalesChart" canvas ID改为"platformSalesChart"，避免ID冲突
- **添加新代码**：
  1. 准备最近60天每日销量统计数据：
     ```javascript
     // 准备最近60天每日销量统计数据
     const dailySalesStatsData = <?php 
         $dailySalesStatsData = [
             'dates' => [],
             'sales' => []
         ];
         if (!empty($dailySalesStats)) {
             foreach ($dailySalesStats as $stat) {
                 $dailySalesStatsData['dates'][] = $stat['date'];
                 $dailySalesStatsData['sales'][] = floatval($stat['total_sales']);
             }
         }
         echo json_encode($dailySalesStatsData);
     ?>;
     ```

  2. 添加drawDailySalesChart函数：
     - 绘制最近60天每日销量统计的折线图
     - 显示日期标签和销售额数值
     - 添加网格线和图表标题

  3. 更新drawAllCharts函数：
     - 添加对drawDailySalesChart函数的调用
     - 修改原有的drawLineChart调用，使用新的canvas ID

### 4. 技术要点

- **代码复用**：参照order_profit/stats.php文件中的图表实现方式，保持代码风格一致
- **数据获取**：使用现有的`getDailySalesStats`方法获取最近60天的每日销量统计数据
- **JavaScript图表绘制**：使用Canvas API手动绘制折线图，包括网格线、数据点、标签等
- **ID冲突解决**：修改原有的canvas ID，避免与新添加的图表ID冲突
- **用户体验**：将重要的统计图表放在dashboard.php页面的最上面，方便用户快速查看

### 5. 影响范围

- **AuthController.php**：添加了获取最近60天每日销量统计数据的代码
- **dashboard.php**：
  - 添加了"最近60天每日销量统计"图表
  - 修改了原有的canvas ID，避免冲突
  - 添加了对应的JavaScript代码
- **数据显示**：用户现在可以在dashboard.php页面的最上面看到最近60天的每日销量统计图表
- **用户体验**：重要的销售趋势图表现在更加突出，方便用户快速了解销售情况

## 测试建议

1. **功能测试**：
   - 验证dashboard.php页面的最上面是否显示"最近60天每日销量统计"图表
   - 确认图表是否正确渲染，包括折线、网格线、标签等
   - 验证图表数据是否与order_profit/stats.php页面中的对应数据一致

2. **数据验证**：
   - 手动计算最近60天的每日销量数据，与dashboard.php页面显示的数据进行对比
   - 验证图表中的日期范围是否正确（最近60天）

3. **布局测试**：
   - 验证页面布局是否整洁，图表是否与其他内容协调
   - 测试不同屏幕尺寸下的页面显示效果

4. **性能测试**：
   - 验证页面加载速度是否受到影响
   - 测试图表渲染是否流畅

## 总结

本次修改通过以下步骤将"最近60天每日销量统计"图表添加到了dashboard.php页面的最上面：

1. **控制器层**：添加了获取最近60天每日销量统计数据的代码
2. **视图层**：在页面中添加了图表容器和标题
3. **JavaScript代码**：
   - 修改了原有的canvas ID，避免冲突
   - 添加了数据准备代码
   - 添加了图表绘制函数
   - 更新了图表绘制调用

这样，用户现在可以在dashboard.php页面的最上面看到"最近60天每日销量统计"图表，方便快速了解销售趋势，同时保持了页面布局的整洁和一致性。