# 车型数据动态筛选功能实现

## 更新日期
2026-01-08

## 更新内容
实现了车型数据管理页面的动态筛选功能，用户选择父级筛选条件后，子级筛选条件会自动更新为关联数据，提高筛选效率和用户体验。

## 技术实现

### 1. 模型层（CarData.php）
添加了6个获取关联筛选数据的方法：
- `getModelsByMake`: 根据品牌(英文)获取车型列表
- `getModelsByMakeCn`: 根据品牌(中文)获取车型列表
- `getYearsByMakeAndModel`: 根据品牌(英文)和车型获取年份列表
- `getYearsByMakeCnAndModel`: 根据品牌(中文)和车型获取年份列表
- `getMarketsByMakeModelAndYear`: 根据品牌(英文)、车型和年份获取市场列表
- `getMarketsByMakeCnModelAndYear`: 根据品牌(中文)、车型和年份获取市场列表

这些方法使用参数化SQL查询，确保数据准确性和安全性。

### 2. 控制器层（CarDataController.php）
添加了6个API接口方法，对应模型层的关联数据获取方法：
- `getModelsByMake`
- `getModelsByMakeCn`
- `getYearsByMakeAndModel`
- `getYearsByMakeCnAndModel`
- `getMarketsByMakeModelAndYear`
- `getMarketsByMakeCnModelAndYear`

每个接口实现了权限验证和参数验证，并返回JSON格式的数据。

### 3. 视图层（index.php）
添加了完整的JavaScript动态筛选逻辑：
- 实现了下拉框的级联更新：品牌 → 车型 → 年份 → 市场
- 实现了品牌(英文)和品牌(中文)的互斥选择
- 使用fetch API发送异步请求，提高用户体验

### 4. 路由层（car_data.php）
添加了6个API接口的路由处理，确保请求能够正确到达对应的控制器方法。

## 功能特点
- 动态加载关联数据，减少不必要的数据传输
- 提供良好的用户体验，选择父级筛选条件后自动更新子级选项
- 支持品牌(英文)和品牌(中文)两种筛选方式
- 实现了完整的筛选链：品牌 → 车型 → 年份 → 市场
- 所有PHP文件通过语法检查，确保代码的正确性

## 文件修改清单
1. `admin-panel/models/CarData.php` - 添加关联数据获取方法
2. `admin-panel/controllers/CarDataController.php` - 添加API接口方法
3. `admin-panel/views/car_data/index.php` - 添加JavaScript动态筛选逻辑
4. `admin-panel/car_data.php` - 添加API路由处理

## 使用说明
1. 在车型数据管理页面，选择品牌(英文)或品牌(中文)
2. 车型下拉框会自动更新为该品牌下的车型列表
3. 选择车型后，年份下拉框会自动更新为该车型下的年份列表
4. 选择年份后，市场下拉框会自动更新为该年份下的市场列表
5. 点击"筛选"按钮查看筛选结果
6. 点击"重置"按钮恢复所有筛选条件

## 预期效果
用户可以更快速、更准确地筛选所需的车型数据，减少无效操作，提高工作效率。