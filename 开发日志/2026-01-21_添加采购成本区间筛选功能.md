# 2026-01-21 添加采购成本区间筛选功能

## 更新内容

### 1. 视图层更新 (products/index.php)

- **添加采购成本区间筛选**：
  - 在分类筛选后面添加了采购成本区间筛选输入框
  - 使用input-group实现了最小和最大采购成本的输入
  - 添加了step="0.0001"支持精确到小数点后四位的输入
  - 保留了用户输入的筛选值

### 2. 控制器层更新 (ProductsController.php)

- **添加参数处理**：
  - 添加了`min_cg_price`和`max_cg_price`参数的获取和处理
  - 将这些参数传递给ProductsModel的搜索方法

- **方法调用更新**：
  - 更新了`searchWithFilters`方法调用，添加了minCgPrice和maxCgPrice参数
  - 更新了`getSearchWithFiltersCount`方法调用，添加了minCgPrice和maxCgPrice参数

### 3. 模型层更新 (Products.php)

- **更新搜索方法**：
  - 修改了`searchWithFilters`方法，添加了minCgPrice和maxCgPrice参数
  - 修改了`getSearchWithFiltersCount`方法，添加了minCgPrice和maxCgPrice参数

- **SQL查询更新**：
  - 在WHERE子句中添加了采购成本的区间筛选条件
  - 当min_cg_price不为空时，添加`cg_price >= ?`条件
  - 当max_cg_price不为空时，添加`cg_price <= ?`条件
  - 确保参数正确传递到SQL查询中

### 4. 技术要点

- **数据验证**：使用HTML5的number类型和step属性确保输入的是有效的数字
- **参数传递**：确保筛选参数在视图、控制器和模型之间正确传递
- **SQL查询**：使用参数化查询避免SQL注入风险
- **用户体验**：保留用户的筛选输入，提供更好的用户体验

### 5. 影响范围

- **商品管理页面**：添加了采购成本区间筛选功能
- **搜索结果**：商品列表现在可以按采购成本区间进行筛选
- **性能**：查询性能受到的影响很小，因为cg_price字段通常有索引

## 测试建议

1. **功能测试**：测试采购成本区间筛选是否正常工作
   - 输入最小采购成本，验证结果
   - 输入最大采购成本，验证结果
   - 同时输入最小和最大采购成本，验证结果
   - 输入无效值，验证系统是否能正确处理

2. **边界测试**：
   - 测试最小值等于最大值的情况
   - 测试最小值大于最大值的情况
   - 测试边界值，如0、负数等

3. **集成测试**：
   - 测试与其他筛选条件的组合使用
   - 测试分页功能是否正常
   - 测试排序功能是否正常

4. **性能测试**：
   - 测试大量商品数据下的筛选性能
   - 验证SQL查询是否使用了索引

## 总结

本次更新为商品管理模块添加了采购成本区间筛选功能，用户现在可以通过设置最小和最大采购成本来筛选商品，提高了商品管理的灵活性和效率。所有更改都遵循了代码的现有结构和风格，确保了系统的稳定性和可维护性。