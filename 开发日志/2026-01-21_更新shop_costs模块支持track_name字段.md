# 2026-01-21 更新shop_costs模块支持track_name字段

## 更新内容

### 1. 模型层更新 (ShopCosts.php)

- **添加track_name字段支持**：
  - 修改`create`方法，添加track_name参数
  - 修改`update`方法，添加track_name参数
  - 修改`batchInsert`方法，添加track_name字段
  - 修改所有筛选和搜索方法，添加track_name参数

- **新增方法**：
  - `getTrackList()`：获取赛道名称列表（用于筛选）
  - `getLastMonthByTrack()`：获取上个月按赛道名称的费用统计

- **修改方法**：
  - `searchWithFilters()`：添加track_name参数
  - `getSearchWithFiltersCount()`：添加track_name参数
  - `getAllWithFilters()`：添加track_name参数

### 2. 控制器层更新 (ShopCostsController.php)

- **添加track_name字段处理**：
  - 修改`index`方法，添加track_name参数的处理
  - 修改`createPost`方法，添加track_name字段的处理
  - 修改`editPost`方法，添加track_name字段的处理
  - 修改`search`方法，添加track_name参数的处理
  - 修改`export`方法，添加track_name参数的处理
  - 修改`processImportRow`方法，调整CSV格式以包含track_name字段

- **参数传递**：
  - 在所有相关方法中添加track_name参数的传递
  - 更新视图数据传递，添加trackList

### 3. 视图层更新

- **index.php**：
  - 添加赛道名称筛选下拉框
  - 在表格中添加赛道名称列
  - 更新导出链接，添加track_name参数
  - 更新空数据提示行的colspan

- **create.php**：
  - 添加赛道名称输入字段（必填）
  - 更新表单布局，调整为三列布局
  - 添加赛道名称字段说明

- **edit.php**：
  - 添加赛道名称输入字段（必填）
  - 更新表单布局，调整为三列布局

### 4. CSV导入导出格式更新

- **导入格式**：
  - 新的CSV列顺序：平台名称, 店铺名称, 赛道名称, 费用金额, 费用类型, 日期, 备注
  - 添加赛道名称为必填字段

- **导出格式**：
  - 新的CSV列顺序：平台名称, 店铺名称, 赛道名称, 费用金额（美元）, 费用类型, 日期, 备注, 创建时间, 更新时间
  - 添加赛道名称列

## 技术要点

1. **数据一致性**：确保track_name字段在所有相关方法中都有正确的处理
2. **表单验证**：在创建和编辑表单中添加赛道名称的必填验证
3. **CSV格式兼容**：更新导入导出逻辑，确保新的CSV格式与旧格式的兼容
4. **代码可读性**：保持代码结构清晰，添加必要的注释

## 影响范围

- **数据存储**：shop_costs表的track_name字段现在会被正确填充
- **数据查询**：所有相关查询现在支持按赛道名称筛选
- **数据导入导出**：CSV文件现在包含赛道名称字段
- **用户界面**：所有相关视图现在显示赛道名称字段

## 测试建议

1. **创建记录**：测试创建新的费用记录，确保赛道名称字段正常工作
2. **编辑记录**：测试编辑现有费用记录，确保赛道名称字段可以更新
3. **导入数据**：测试使用新的CSV格式导入数据，确保赛道名称被正确处理
4. **导出数据**：测试导出数据，确保CSV文件包含赛道名称列
5. **筛选功能**：测试按赛道名称筛选费用记录，确保功能正常
6. **统计功能**：测试按赛道名称统计费用，确保数据准确