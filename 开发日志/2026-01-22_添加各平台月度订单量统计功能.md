# 2026-01-22 添加各平台月度订单量统计功能

## 功能描述

- **功能名称**：各平台月度订单量统计
- **功能位置**：dashboard.php页面，在"各平台月度销售额统计"之前
- **功能说明**：显示每个平台在本月、上月、上上月的订单量，以及上月对比上上月的增长率

## 实现方案

### 1. 模型层更新 (OrderProfit.php)

- **添加方法**：`getPlatformMonthlyOrderStats()`
- **方法功能**：获取各个平台的月度订单量统计数据
- **实现细节**：
  - 计算本月、上月、上上月的年份和月份
  - 构建SQL查询，使用CASE语句和COUNT函数统计每个月的订单量
  - 处理结果，计算上月对比上上月的增长率
  - 返回统计数据数组

### 2. 控制器层更新 (AuthController.php)

- **添加代码**：在获取平台月度销售额统计数据之后，添加获取平台月度订单量统计数据的代码
- **具体更改**：
  ```php
  // 获取各平台月度订单量统计数据
  $platformMonthlyOrderStats = $orderProfitModel->getPlatformMonthlyOrderStats();
  ```

### 3. 视图层更新 (dashboard.php)

- **添加表格**：在"各平台月度销售额统计"之前，添加"各平台月度订单量统计"的表格
- **实现细节**：
  - 参照"各平台月度销售额统计"的表格结构
  - 显示平台名称、本月订单量、上月订单量、上上月订单量、增长率
  - 使用与销售额统计相同的月份名称显示逻辑
  - 使用与销售额统计相同的增长率计算和显示逻辑

### 4. 技术要点

- **SQL优化**：使用CASE语句和COUNT函数在一次查询中统计多个月份的订单量
- **数据处理**：计算上月对比上上月的增长率，使用条件格式化显示增长/下降
- **代码复用**：参照"各平台月度销售额统计"的实现方式，保持代码风格一致
- **用户体验**：提供清晰的订单量统计表格，与销售额统计保持相同的布局和风格

### 5. 影响范围

- **dashboard.php**：新增"各平台月度订单量统计"表格，显示每个平台的月度订单量数据
- **数据准确性**：订单量统计基于order_profit表中的实际记录数，确保数据准确
- **用户体验**：用户现在可以同时查看销售额和订单量的月度统计，方便对比分析

## 测试建议

1. **功能测试**：
   - 验证dashboard.php页面中是否显示"各平台月度订单量统计"表格
   - 确认表格中是否显示平台名称、本月订单量、上月订单量、上上月订单量、增长率
   - 验证增长率计算是否正确

2. **数据验证**：
   - 手动计算每个平台的月度订单量，与表格显示的数据进行对比
   - 验证增长率计算是否正确

3. **边界测试**：
   - 测试某个平台在某个月份没有订单的情况
   - 测试所有平台在某个月份都没有订单的情况
   - 测试上上月没有订单的情况（增长率计算）

## 总结

本次修改通过以下步骤实现了"各平台月度订单量统计"功能：

1. **模型层**：添加了`getPlatformMonthlyOrderStats()`方法，用于获取各个平台的月度订单量统计数据
2. **控制器层**：添加了获取平台月度订单量统计数据的代码
3. **视图层**：添加了"各平台月度订单量统计"表格，参照了"各平台月度销售额统计"的实现方式

这样，用户现在可以在dashboard.php页面上同时查看销售额和订单量的月度统计，方便对比分析各平台的销售表现。