# 2026-01-22 将最近60天每日销量统计板块添加到dashboard页面

## 功能描述

- **功能名称**：最近60天每日销量统计
- **功能位置**：dashboard.php页面的最上面，欢迎信息卡片内部，赛道统计模块之前
- **功能说明**：显示最近60天每日的销量统计数据，使用折线图展示销售趋势

## 实现方案

### 1. 控制器层更新 (AuthController.php)

- **添加代码**：在获取最近30天按平台统计数据之后，添加获取最近60天每日销量统计数据的代码
- **具体更改**：
  ```php
  // 获取最近60天每日销量统计数据
  $startDate60 = date('Y-m-d', strtotime('-60 days'));
  $dailySalesStats = $orderProfitModel->getDailySalesStats($startDate60, $endDate);
  ```

### 2. 视图层更新 (dashboard.php)

- **添加HTML代码**：在欢迎信息卡片内部，赛道统计模块之前，添加"最近60天每日销量统计"的板块
- **实现细节**：
  - 添加一个新的卡片，包含标题和canvas元素
  - 使用`dailySalesStatsChart`作为canvas的ID，避免与现有的`dailySalesChart`冲突

### 3. JavaScript代码更新 (dashboard.php)

- **添加数据准备代码**：
  ```javascript
  // 准备最近60天每日销量统计数据
  const dailySalesStatsData = <?php 
      $dailySalesStatsData = [
          'dates' => [],
          'sales' => []
      ];
      if (!empty($dailySalesStats)) {
          foreach ($dailySalesStats as $stat) {
              $dailySalesStatsData['dates'][] = $stat['sale_date'];
              $dailySalesStatsData['sales'][] = floatval($stat['order_count']);
          }
      }
      echo json_encode($dailySalesStatsData);
  ?>;
  ```

- **添加图表绘制函数**：
  - 添加`drawDailySalesStatsChart`函数，用于绘制最近60天每日销量统计图表
  - 使用Canvas API绘制折线图，包括网格线、数据点、标签等

- **更新drawAllCharts函数**：
  - 添加对`drawDailySalesStatsChart`函数的调用
  - 确保新添加的图表能够被正确绘制

### 4. 技术要点

- **代码复用**：参照order_profit/stats.php文件中的图表实现方式，保持代码风格一致
- **数据获取**：使用现有的`getDailySalesStats`方法获取最近60天的每日销量统计数据
- **JavaScript图表绘制**：使用Canvas API手动绘制折线图，包括网格线、数据点、标签等
- **ID冲突解决**：为新添加的图表使用一个不同的canvas ID，避免与现有的图表ID冲突
- **用户体验**：将重要的统计图表放在dashboard.php页面的最上面，方便用户快速查看

### 5. 影响范围

- **AuthController.php**：添加了获取最近60天每日销量统计数据的代码
- **dashboard.php**：
  - 添加了"最近60天每日销量统计"板块
  - 添加了对应的JavaScript代码
- **数据显示**：用户现在可以在dashboard.php页面的最上面看到最近60天的每日销量统计图表
- **用户体验**：重要的销售趋势图表现在更加突出，方便用户快速了解销售情况

## 测试建议

1. **功能测试**：
   - 验证dashboard.php页面的最上面是否显示"最近60天每日销量统计"板块
   - 确认图表是否正确渲染，包括折线、网格线、标签等
   - 验证图表数据是否与order_profit/stats.php页面中的对应数据一致

2. **数据验证**：
   - 手动计算最近60天的每日销量数据，与dashboard.php页面显示的数据进行对比
   - 验证图表中的日期范围是否正确（最近60天）

3. **布局测试**：
   - 验证页面布局是否整洁，图表是否与其他内容协调
   - 测试不同屏幕尺寸下的页面显示效果

4. **性能测试**：
   - 验证页面加载速度是否受到影响
   - 测试图表渲染是否流畅

## 总结

本次修改通过以下步骤将"最近60天每日销量统计"板块添加到了dashboard.php页面的最上面：

1. **控制器层**：添加了获取最近60天每日销量统计数据的代码
2. **视图层**：在页面最上面添加了对应的HTML代码
3. **JavaScript代码**：添加了数据准备代码和图表绘制函数
4. **函数调用**：在drawAllCharts函数中添加了对新函数的调用

这样，用户现在可以在dashboard.php页面的最上面看到最近60天的每日销量统计图表，方便快速了解销售趋势。