# 增加赛道统计模块

## 任务描述
在dashboard.php中增加赛道统计模块，统计每个赛道的上月总订单数量、总订单金额、总毛利润、总赛道费用cost、公司成本分摊、总净利润、净利润率等。

## 完成的工作

### 1. 创建TrackStatistics模型
- **文件路径**: `admin-panel/models/TrackStatistics.php`
- **功能**: 实现了获取赛道统计数据的方法，包括：
  - `getTrackStatistics()`: 获取每个赛道的详细统计数据
  - `getTrackSalesData()`: 获取赛道销售数据（用于饼图）
  - `getTrackProfitData()`: 获取赛道利润数据（用于饼图）
- **数据计算逻辑**:
  - 通过store表的track_name关联order_profit表的store_id获取订单数据
  - 通过track_name关联track_costs表获取赛道费用数据
  - 从company_costs表获取公司总成本并按4个赛道平均分摊
  - 计算总净利润和净利润率

### 2. 更新AuthController控制器
- **文件路径**: `admin-panel/controllers/AuthController.php`
- **修改内容**: 在dashboard方法中添加赛道统计数据获取逻辑
  - 引入TrackStatistics模型
  - 创建实例并获取统计数据
  - 将数据传递给视图

### 3. 更新dashboard视图
- **文件路径**: `admin-panel/views/dashboard.php`
- **添加内容**:
  - **赛道统计表格**: 显示每个赛道的详细统计数据，包括总订单数量、总订单金额、总毛利润、总赛道费用、公司成本分摊、总净利润、净利润率
  - **赛道销售占比饼图**: 显示各赛道销售额占比
  - **赛道利润占比饼图**: 显示各赛道利润占比
- **JavaScript更新**:
  - 添加赛道销售数据和利润数据的准备
  - 在drawAllCharts函数中添加绘制赛道图表的代码

### 4. 验证更新
- 使用 `php -l` 命令检查所有更新后的文件
- 确认没有语法错误

## 技术细节
- **数据来源**: 
  - order_profit表: 订单数据
  - track_costs表: 赛道费用数据
  - company_costs表: 公司成本数据
  - store表: 赛道名称和店铺关联
- **时间范围**: 上月（从上月1号到上月最后一天）
- **公司成本分摊**: 公司总成本 / 4（固定4个赛道）
- **净利润计算**: 总毛利润 - 总赛道费用 - 公司成本分摊
- **净利润率计算**: (总净利润 / 总订单金额) * 100%

## 结论
已成功增加赛道统计模块，包括详细的数据表格和可视化图表，为用户提供了清晰的赛道性能分析。